import{a as Y,b as g,c as te,i as ie,j as O,p as R,q as ne,r as oe,t as re,u as $,v as se}from"./chunk-GTGB5SJ3.js";import"./chunk-HEUFHRRO.js";import{l as Z,n as ee}from"./chunk-YECZU7CY.js";import"./chunk-UZ35QZ23.js";import{Ca as c,Jb as q,Kb as l,Lb as S,Na as y,Nb as H,Ob as G,Pb as W,T as j,Vb as Q,Y as p,ba as _,ca as f,cc as z,db as b,eb as v,ec as J,hb as N,ia as u,ib as B,jb as M,jc as X,kb as s,lb as a,mb as K,nb as w,ob as F,tb as k,vb as D,wb as P,xb as d,yb as L,zb as U}from"./chunk-FDEVB4XX.js";var A="update-sshkey/";var I="generate-token/";var ce=(()=>{let e=class e{has(o){return!0}get(o){return null}set(o,n){}};e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=j({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();var me=["*"],le=(()=>{let e=class e{constructor(){this.choice=J()}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=y({type:e,selectors:[["app-dialog-box"]],outputs:{choice:"choice"},ngContentSelectors:me,decls:8,vars:0,consts:[[1,"container"],[1,"btn-row"],[1,"link",3,"click"],[1,"btn","btn-red",3,"click"]],template:function(n,r){n&1&&(L(),w(0,"div",0)(1,"div"),U(2),w(3,"div",1)(4,"div",2),P("click",function(){return r.choice.emit("confirm")}),l(5,"Confirm "),F(),w(6,"div",3),P("click",function(){return r.choice.emit("cancel")}),l(7,"Cancel "),F()()()())},styles:[".container[_ngcontent-%COMP%]{z-index:10;background:#fff;padding:1em;max-width:32rem;position:absolute;top:50%;left:50%;margin-right:-50%;transform:translate(-50%,-50%)}.container[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{border:1px solid rgb(188.7765,193.0248,196.2735);border-radius:.375em;padding:1em}.container[_ngcontent-%COMP%]   .btn-row[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:baseline;gap:1em}"]});let t=e;return t})();var pe=(t,e)=>e.property;function ue(t,e){if(t&1){let i=k();s(0,"app-dialog-box",3),D("choice",function(n){_(i);let r=d();return f(r.choice(n))}),s(1,"p"),l(2,"Deleting account would remove all stored information"),a(),s(3,"p"),l(4,"Are you sure you want to continue?"),a()()}}function he(t,e){if(t&1&&(s(0,"td"),l(1),a()),t&2){let i=d().$implicit;c(),S(i.value)}}function _e(t,e){if(t&1){let i=k();s(0,"td")(1,"app-form",4),W("submittedChange",function(n){_(i);let r=d().$implicit;return G(r.submitted,n)||(r.submitted=n),f(n)}),D("submittedChange",function(){_(i);let n=d().$implicit;return f(n.onSubmit())}),a()()}if(t&2){let i=d().$implicit;c(),M("fields",i.fields)("formDesc",i.formDes),H("submitted",i.submitted)}}function fe(t,e){if(t&1&&(s(0,"p"),l(1),a()),t&2){let i=d(2).$implicit;c(),S(i.value())}}function be(t,e){if(t&1){let i=k();s(0,"td"),b(1,fe,2,1,"p"),s(2,"app-button",5),D("click",function(){_(i);let n=d().$implicit;return f(n.onClick())}),a()()}if(t&2){let i=d().$implicit;c(),v(i.value()?1:-1),c(),M("button",i.button)("busy",i.submitted())}}function ve(t,e){if(t&1&&(s(0,"tr")(1,"td"),l(2),a(),b(3,he,2,1,"td")(4,_e,2,3,"td")(5,be,3,3,"td"),a()),t&2){let i=e.$implicit;c(2),S(i.property),c(),v(i.isText()?3:i.isForm()?4:i.isAction()?5:-1)}}function ge(t,e){if(t&1&&(s(0,"table")(1,"thead")(2,"tr")(3,"th"),l(4,"Property"),a(),s(5,"th"),l(6,"Value"),a()()(),s(7,"tbody"),N(8,ve,6,2,"tr",null,pe),a()()),t&2){let i=d();c(8),B(i.rows())}}function Ce(t,e){t&1&&K(0,"img",2)}var E=class{constructor(e){Object.assign(this,e)}isText(){return this instanceof m}isAction(){return this instanceof C}isForm(){return this instanceof x}},m=class extends E{constructor(e){super(e)}},T=class extends E{constructor(e){e.path=`${$}${e.path}`,super(e),this.submitted=u(!1);let i=e.name.toLowerCase().split(" ").join("-");i=`btn-${i}`,this.button={label:e.name,classes:"primary small",id:i}}_error(e){alert(`Something went wrong ${e}`)}_next(e){return e.status==="login_required"?(this.services.router.navigate(["../login"],{relativeTo:this.services.route}),!1):!0}get(){this.services.backend.get(this.path).subscribe({error:this._error,next:e=>{this._next(e)&&this.next(e)}})}},C=class extends T{constructor(e){super(e),this.value=u(void 0)}onClick(){this.value()||(this.submitted.set(!0),this.get())}next(e){this.value.set(e[this.valueKey]),this.submitted.set(!1)}},x=class extends T{constructor(e){super(e),this.formDes=new ne({class:"inline",button:this.button})}post(e){this.services.backend.post(this.path,e).subscribe({error:this._error,next:i=>{this._next(i)&&this.next(i)}})}onSubmit(){let e=this.submitted();this.post(e)}next(e){this.services.cd.detectChanges(),this.submitted.set(!1)}},V;Y.production?V={provide:g,useClass:g}:V={provide:g,useClass:ce};var Le=(()=>{let e=class e{constructor(){this.initDone=u(!1),this.rows=u([]),this.showAlert=u(!1),this.containerClass=z(()=>this.showAlert()?{flex:!0,disabled:!0}:{flex:!0,disabled:!1});let o=p(te),n=p(X),r=p(g),h=p(Z),de=p(ee);this.services={backend:o,cd:n,cookie:r,router:de,route:h}}ngOnInit(){this.services.cookie.has("csrftoken")?this.services.backend.get($).subscribe({next:o=>{o.status===se.LOGIN_REQUIRED?this.services.router.navigate(["../login"],{relativeTo:this.services.route}):(this.dashboardResponse=o,this.initTable(),this.initDone.set(!0))},error:o=>{this.services.router.navigate(["../login"],{relativeTo:this.services.route})}}):this.services.router.navigate(["../login"],{relativeTo:this.services.route})}initTable(){let o=this.dashboardResponse.username||"",n=this.dashboardResponse.sshPort?`ssh ${o}@api.djongomapper.com -p ${this.dashboardResponse.sshPort}`:"Upload SSH Key",r=[new R({key:"sshField",label:"New SSH key",attr:new O({name:"ssh-key",required:!0}),errors:{other:"Oops something went wrong. We are working to fix this. Please contact: support@doableware.com"}})],h=[new R({key:"message",label:"Message",attr:new O({name:"message",required:!0})})];this.rows.set([new m({property:"Username",value:o}),new m({property:"Base URL",value:`https://api.djongomapper.com/${o}`}),new m({property:"Status",value:this.dashboardResponse.state||""}),new m({property:"SSH Command",value:n}),new x({property:"SSH Public Key",services:this.services,path:A,name:"Update Key",fields:r}),new C({property:"PyPi Access Token",services:this.services,name:"Generate Token",path:I,valueKey:"token"}),new x({property:"Support Request",services:this.services,path:A,name:"Send",fields:h}),new C({property:"Delete Account",services:this.services,name:"Delete",path:I,valueKey:"token"})])}choice(o){o=="confirm",this.showAlert.set(!1)}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=y({type:e,selectors:[["app-dashboard"]],features:[Q([V])],decls:6,vars:4,consts:[["role","main",1,"page-fixed"],[1,"page-content"],["src","/assets/images/spinner.svg","alt","Button is busy",2,"height","100px","margin","calc(50% - 50px) auto"],[3,"choice"],[3,"submittedChange","fields","formDesc","submitted"],[3,"click","button","busy"]],template:function(n,r){n&1&&(s(0,"main",0)(1,"div",1),b(2,ue,5,0,"app-dialog-box"),s(3,"div"),b(4,ge,10,0,"table")(5,Ce,1,0,"img",2),a()()()),n&2&&(c(2),v(r.showAlert()?2:-1),c(),q(r.containerClass()),c(),v(r.initDone()?4:5))},dependencies:[re,oe,ie,le],styles:["td[_ngcontent-%COMP%]:first-child, th[_ngcontent-%COMP%]:first-child{padding-left:1em}table[_ngcontent-%COMP%]{margin:3em auto 1em;display:table}#center[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;margin-right:-50%;transform:translate(-50%,-50%)}div.disabled[_ngcontent-%COMP%]{pointer-events:none;opacity:.7}"]});let t=e;return t})();export{Le as DashboardComponent};
